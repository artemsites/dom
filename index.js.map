{"version":3,"file":"index.js","sources":["node_modules/mitt/dist/mitt.mjs","index.ts"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","/**\n * @source https://github.com/artemsites/dom\n * @source https://gitverse.ru/artemsites/dom\n *\n * @api:\n * createScope - creating an object in the DOM for working with the library\n * ref - reactive state\n * data-class is an attribute of an HTML element for dynamic class management\n */\nimport mitt from \"mitt\";\n\ninterface State {\n  value: boolean;\n}\n\ndeclare global {\n  interface Window {\n    [key: string]: any;\n  }\n}\n\nconst emitter = mitt();\n\nlet stateNamesHashes = new Map();\n\nexport function createScope(scopeId: string, scopeApp: () => void) {\n  const wrapper = document.getElementById(scopeId);\n\n  if (wrapper) {\n    const appInstance = scopeApp();\n\n    handlerClasses(wrapper, appInstance);\n\n    window[scopeId] = appInstance;\n  } else {\n    throw Error(\"Нет wrapper: #\" + scopeId);\n  }\n}\n\nexport function ref(defaultValue: any) {\n  const stateNameHash = `state_${crypto.randomUUID()}`;\n\n  const proxyState = new Proxy(\n    { value: defaultValue },\n    {\n      set(target, prop, value) {\n        if (prop === \"value\") {\n          target[prop] = value;\n          emitter.emit(stateNameHash, target);\n          return true;\n        }\n        return false;\n      },\n    }\n  );\n\n  stateNamesHashes.set(proxyState, stateNameHash);\n\n  emitter.emit(stateNameHash, proxyState);\n\n  return proxyState;\n}\n\nfunction handlerClasses(wrapper: HTMLElement, appInstance: any) {\n  const $classes = wrapper.querySelectorAll(\n    \"[data-class]\"\n  ) as NodeListOf<HTMLElement>;\n\n  $classes.forEach(($el) => {\n    if ($el.dataset.class) {\n      let jsonString = $el.dataset.class;\n\n      $el.removeAttribute(\"data-class\");\n\n      const parsedJson = JSON.parse(jsonString);\n      if (Array.isArray(parsedJson)) {\n        for (let i in parsedJson) {\n          let jsExpressionTernary = parsedJson[i];\n\n          const regex = /(.+?)\\s*\\?\\s*(.+?)\\s*:\\s*(.+)/;\n          const match = jsExpressionTernary.match(regex);\n\n          let jsNameWithPrefix = match[1];\n          const classNameTrue = match[2];\n          const classNameFalse = match[3];\n          const className = [classNameTrue, classNameFalse];\n\n          handlerClassesInner($el, className, jsNameWithPrefix);\n        }\n      } else if (isObject(parsedJson)) {\n        for (let className in parsedJson) {\n          let jsNameWithPrefix = parsedJson[className];\n\n          handlerClassesInner($el, className, jsNameWithPrefix);\n        }\n      }\n    }\n  });\n\n  function handlerClassesInner(\n    $el: HTMLElement,\n    className: string | string[],\n    jsNameWithPrefix: string\n  ) {\n    let isRevertVal = false;\n    if (jsNameWithPrefix[0] === \"!\") {\n      isRevertVal = true;\n      jsNameWithPrefix = jsNameWithPrefix.slice(1);\n    }\n\n    let jsName = jsNameWithPrefix.replace(/^\\w+\\./, \"\");\n\n    const state = appInstance[jsName];\n\n    toggleClass(state, className, $el, isRevertVal);\n    let stateNameHash = stateNamesHashes.get(state);\n\n    emitter.on(stateNameHash, (newState) => {\n      toggleClass(newState as State, className, $el, isRevertVal);\n    });\n  }\n}\n\nfunction toggleClass(\n  state: State,\n  className: string | string[],\n  where: HTMLElement,\n  isRevertVal = false\n) {\n  if (state.value && !isRevertVal) {\n    if (Array.isArray(className)) {\n      where.classList.remove(className[1]);\n      where.classList.add(className[0]);\n    } else {\n      where.classList.add(className);\n    }\n  } else {\n    if (Array.isArray(className)) {\n      where.classList.remove(className[0]);\n      where.classList.add(className[1]);\n    } else {\n      where.classList.remove(className);\n    }\n  }\n}\n\nfunction isObject(value: any) {\n  return value !== null && typeof value === \"object\";\n}\n"],"names":["mitt","t","e","i","n","emitter","stateNamesHashes","createScope","scopeId","scopeApp","wrapper","appInstance","handlerClasses","ref","defaultValue","stateNameHash","proxyState","target","prop","value","$el","jsonString","parsedJson","jsExpressionTernary","regex","match","jsNameWithPrefix","classNameTrue","classNameFalse","handlerClassesInner","isObject","className","isRevertVal","jsName","state","toggleClass","newState","where"],"mappings":"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","x_google_ignoreList":[0]}