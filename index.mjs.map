{"version":3,"file":"index.mjs","sources":["node_modules/mitt/dist/mitt.mjs","index.ts"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","/**\n * @source https://github.com/artemsites/dom\n * @source https://gitverse.ru/artemsites/dom\n *\n * @api:\n * createScope - creating an object in the DOM for working with the library\n * ref - reactive state\n * data-class is an attribute of an HTML element for dynamic class management\n */\n\n// @note for browser js module\n// import mitt from \"../node_modules/mitt/dist/mitt.mjs\";\n\n// @note for vite compile\nimport mitt from \"mitt\";\n\ninterface State {\n  value: boolean;\n}\n\ndeclare global {\n  interface Window {\n    [key: string]: any;\n  }\n}\n\nconst emitter = mitt();\n\nlet stateNamesHashes = new Map();\n\nexport function createScope(scopeId: string, scopeApp: () => void) {\n  const wrapper = document.getElementById(scopeId);\n\n  if (wrapper) {\n    const appInstance = scopeApp();\n\n    handlerClasses(wrapper, appInstance);\n\n    window[scopeId] = appInstance;\n  } else {\n    throw Error(\"Нет wrapper: #\" + scopeId);\n  }\n}\n\nexport function ref(defaultValue: any) {\n  const stateNameHash = `state_${crypto.randomUUID()}`;\n\n  const proxyState = new Proxy(\n    { value: defaultValue },\n    {\n      set(target, prop, value) {\n        if (prop === \"value\") {\n          target[prop] = value;\n          emitter.emit(stateNameHash, target);\n          return true;\n        }\n        return false;\n      },\n    }\n  );\n\n  stateNamesHashes.set(proxyState, stateNameHash);\n\n  emitter.emit(stateNameHash, proxyState);\n\n  return proxyState;\n}\n\nfunction handlerClasses(wrapper: HTMLElement, appInstance: any) {\n  const $classes = wrapper.querySelectorAll(\n    \"[data-class]\"\n  ) as NodeListOf<HTMLElement>;\n\n  $classes.forEach(($el) => {\n    if ($el.dataset.class) {\n      let jsonString = $el.dataset.class;\n\n      $el.removeAttribute(\"data-class\");\n\n      const parsedJson = JSON.parse(jsonString);\n      if (Array.isArray(parsedJson)) {\n        for (let i in parsedJson) {\n          let jsExpressionTernary = parsedJson[i];\n\n          const regex = /(.+?)\\s*\\?\\s*(.+?)\\s*:\\s*(.+)/;\n          const match = jsExpressionTernary.match(regex);\n\n          let jsNameWithPrefix = match[1];\n          const classNameTrue = match[2];\n          const classNameFalse = match[3];\n          const className = [classNameTrue, classNameFalse];\n\n          handlerClassesInner($el, className, jsNameWithPrefix);\n        }\n      } else if (isObject(parsedJson)) {\n        for (let className in parsedJson) {\n          let jsNameWithPrefix = parsedJson[className];\n\n          handlerClassesInner($el, className, jsNameWithPrefix);\n        }\n      }\n    }\n  });\n\n  function handlerClassesInner(\n    $el: HTMLElement,\n    className: string | string[],\n    jsNameWithPrefix: string\n  ) {\n    let isRevertVal = false;\n    if (jsNameWithPrefix[0] === \"!\") {\n      isRevertVal = true;\n      jsNameWithPrefix = jsNameWithPrefix.slice(1);\n    }\n\n    let jsName = jsNameWithPrefix.replace(/^\\w+\\./, \"\");\n\n    const state = appInstance[jsName];\n\n    toggleClass(state, className, $el, isRevertVal);\n    let stateNameHash = stateNamesHashes.get(state);\n\n    emitter.on(stateNameHash, (newState) => {\n      toggleClass(newState as State, className, $el, isRevertVal);\n    });\n  }\n}\n\nfunction toggleClass(\n  state: State,\n  className: string | string[],\n  where: HTMLElement,\n  isRevertVal = false\n) {\n  if (state.value && !isRevertVal) {\n    if (Array.isArray(className)) {\n      where.classList.remove(className[1]);\n      where.classList.add(className[0]);\n    } else {\n      where.classList.add(className);\n    }\n  } else {\n    if (Array.isArray(className)) {\n      where.classList.remove(className[0]);\n      where.classList.add(className[1]);\n    } else {\n      where.classList.remove(className);\n    }\n  }\n}\n\nfunction isObject(value: any) {\n  return value !== null && typeof value === \"object\";\n}\n"],"names":["mitt","n","e","i","emitter","stateNamesHashes","createScope","scopeId","scopeApp","wrapper","appInstance","handlerClasses","ref","defaultValue","stateNameHash","proxyState","target","prop","value","$el","jsonString","parsedJson","jsExpressionTernary","regex","match","jsNameWithPrefix","classNameTrue","classNameFalse","handlerClassesInner","isObject","className","isRevertVal","jsName","state","toggleClass","newState","where"],"mappings":"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","x_google_ignoreList":[0]}